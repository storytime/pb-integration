/**
 * SSH deploy
 */

ssh.settings {
    knownHosts = allowAnyHosts
}

remotes {
    devServer {
        /**
         * You need create a gradle.properties and put all need value into that file
         */
        host = project.hasProperty('pb.ssh.host') ? project.property('pb.ssh.host') : ""
        user = project.hasProperty('pb.ssh.user') ? project.property('pb.ssh.user') : ""
        port = project.hasProperty('pb.ssh.port') ? project.property('pb.ssh.port') as Integer : 22
        identity = file(System.getProperty("user.home") + '/.ssh/id_rsa')
    }
}

task uploadComposeFileToServer {
    doLast {

        ssh.run {
            session(remotes.devServer) {
                put from: "/Users/bo/IdeaProjects/pb-integration-tmp/docker-compose.yml", into: "/tmp/docker-compose.yml"
                put from: "/Users/bo/IdeaProjects/pb-integration-tmp/variables.env", into: "/tmp/variables.env"
                // need to avoid user name
                execute("mv /tmp/docker-compose.yml /home/appuser/pb-sync-aws/docker-compose.yml", pty: true)
                execute("mv /tmp/variables.env  /home/appuser/pb-sync-aws/variables.env", pty: true)
            }
        }
    }
}